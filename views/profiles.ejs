<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>User Profiles</title>
    <link rel="stylesheet" href="/css/profiles.css">
</head>

<body>
    <!-- Navbar -->
    <nav>
        <div class="website-name">Turbo<span>Care</span></div>
        <div class="nav-links">
            <a href="/admin_dashboard">ðŸ“Š Dashboard</a>
            <a href="/profiles">ðŸ“‹ Manage Users & Bookings</a>
            <button class="login" id="logoutBtn">Logout</button>
        </div>
    </nav>

    <!-- Search Bar -->
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search profiles by name...">
    </div>

    <!-- Profiles List -->
    <div class="profiles-container">
        <% users.forEach(user=> { %>
            <div class="profile-card">
                <a href="/profile/<%= user.user_id %>">
                    <img src="<%= user.profile_image || '/photoes/ChatGPT Image Aug 28, 2025, 07_37_37 AM.png' %>"
                        alt="Profile Image">
                    <h2>
                        <%= user.name %>
                    </h2>
                    <p>
                        <%= user.phone %>
                    </p>
                    <p>
                        <%= user.email %>
                    </p>
                    <p>
                        <%= user.address %>
                    </p>
                </a>
            </div>
            <% }) %>
    </div>

    <script>
        // Fade + Scale effect on scroll
        function updateCardStyles() {
            const cards = document.querySelectorAll(".profile-card");
            const centerY = window.innerHeight / 2;

            cards.forEach(card => {
                const rect = card.getBoundingClientRect();
                const cardCenter = rect.top + rect.height / 2;
                const distance = Math.abs(centerY - cardCenter);

                // Scale & opacity decrease with distance
                const scale = Math.max(0.8, 1 - distance / 1000);
                const opacity = Math.max(0.4, 1 - distance / 600);

                card.style.transform = `scale(${scale})`;
                card.style.opacity = opacity;
            });
        }

        window.addEventListener("scroll", updateCardStyles);
        window.addEventListener("resize", updateCardStyles);
        window.addEventListener("load", updateCardStyles);

        // Search filter
        document.getElementById("searchInput").addEventListener("input", function () {
            const filter = this.value.toLowerCase();
            document.querySelectorAll(".profile-card").forEach(card => {
                const name = card.querySelector("h2").innerText.toLowerCase();
                card.style.display = name.includes(filter) ? "" : "none";
            });
        });

        document.getElementById("logoutBtn").addEventListener("click", async () => {
            try {
                const res = await fetch('/logout', { method: 'POST' });
                if (res.ok) window.location = '/';
            } catch (e) {
                console.error(e);
                window.location = '/';
            }
        });
    </script>
</body>

</html>